# PRD: Factset Audit POC - Document Viewer Prototype

**Version:** 1.0  
**Date:** 2025-12-08  
**Status:** In Progress  
**Related Issues:** [QT-46](https://linear.app/betalgeuse/issue/QT-46), [QT-65](https://linear.app/betalgeuse/issue/QT-65)  
**Project Name:** audit

---

## 1. Executive Summary

### 1.1 Product Vision
A unified workspace that enables users to efficiently audit, analyze, and research financial documents. The platform allows users to track identical line items (e.g., operating profit) across multiple years and 10-K filings, while instantly verifying numbers and footnote locations in original source documents.

### 1.2 POC Objective
Build a rapid Next.js prototype demonstrating the core value proposition: **"Click a number ??View source document ??See highlighted location"**

### 1.3 Target Users
- Financial Analysts
- Auditors
- CPA
- Institutional Investors
- Research Teams
- Law Firm
- Policy Makers
- Investment Managements
- Hedge Funds
- Consulting Firms

---

## 2. Scope Definition

### 2.1 In Scope (POC)

| Feature | Priority | Description |
|---------|----------|-------------|
| Landing Page Table | P0 | GAAP/IFRS Financial Statement with clickable cells |
| Document Viewer Popup | P0 | Modal displaying source PDF with navigation/ Footnote and Reference popups|
| Clickable Number Cells | P0 | Hover states + click to open viewer |
| Section Navigation | P0 | Left sidebar TOC in Document Viewer |
| Auto-scroll to Section | P0 | Navigate to relevant document section |
| Highlight Display | P0 | Yellow highlight on related data |
| Close Functionality | P0 | ESC key, X button, outside click |
| KR/US Market Tabs | P1 | Toggle between AMAT (US) and SK Hynix (KR) |

### 2.2 Footnote, Reference & Appendix Popup System (P0 - Core Feature)

The inline popup system is a **core differentiating feature** that eliminates the need for users to scroll back and forth between the main content and reference sections. This significantly improves the reading experience for financial analysts and auditors working with complex 10-K documents.

| Feature | Priority | Description |
|---------|----------|-------------|
| Footnote Hover Popup | P0 | Hover over footnote markers (e.g., ¹, ², *) to see content inline |
| Reference Link Preview | P0 | Click/hover on "See Note 12" to preview that note section |
| Appendix Quick View | P0 | Inline preview of appendix content without navigation |
| Smart Positioning | P0 | Popup appears near cursor, avoids viewport edges |
| Persistent Mode | P1 | Click to pin popup, continue reading with reference visible |

### 2.3 UI Mockup Only (Non-functional)

| Feature | Description |
|---------|-------------|
| Flagging/Bookmark | UI buttons visible, no backend logic |
| AI Summarize/Q&A | UI placeholders only |
| Cross-document Tracking | Visual indicators only |
| Notes/Annotations | UI elements without persistence |

### 2.4 Out of Scope

- PDF download functionality
- Export features
- Full-text search within documents
- Zoom controls
- Precise document-to-data mapping logic
- Real-time data feeds
- User authentication
- Data persistence

---

## 3. User Flow

```
?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�????                    LANDING PAGE                                     ???? ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?? ???? ?? [US Market] [KR Market]                                       ?? ???? ??                                                               ?? ???? ?? Company: Applied Materials, Inc. (AMAT)  |  $268.00          ?? ???? ?? ?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?? ???? ?? GAAP/IFRS Income Statement                                   ?? ???? ?? ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?��??�?�?�?�?�?�?�??       ?? ???? ?? ??             ??FY15   ??FY16   ??FY17   ??FY25   ??       ?? ???? ?? ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?��??�?�?�?�?�?�?�??       ?? ???? ?? ??Sales        ??[9,659]??10,825]??14,537]??       ????Click?? ???? ?? ??COGS         ?? 6,706 ?? 6,202 ?? 8,020 ??       ??       ?? ???? ?? ??Gross Income ?? 2,953 ?? 4,623 ?? 6,517 ??       ??       ?? ???? ?? ??Net Income   ?? 1,377 ?? 1,721 ?? 3,434 ??       ??       ?? ???? ?? ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?��??�?�?�?�?�?�?�??       ?? ???? ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?? ???��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??                              ??                              ??Click number cell
                              ???��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�????                  DOCUMENT VIEWER POPUP                              ???? ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?? ???? ?? FACTSET | Document Viewer                              [X]   ?? ???? ?? ?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?? ???? ?? Entity: APPLIED MATERIALS INC /DE                            ?? ???? ?? Filing Type: 10-K  |  End Date: 2017-10-29                  ?? ???? ?? ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?? ?? ???? ?? ??[Navigation]   ?? [Document Content]                    ?? ?? ???? ?? ??               ??                                       ?? ?? ???? ?? ??Cover          ?? Consolidated Balance Sheets           ?? ?? ???? ?? ??Document Info  ?? (USD $) In Millions                  ?? ?? ???? ?? ??               ?? ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?? ?? ?? ???? ?? ??Financial      ?? ??             ??Oct 2017?�Oct 2016?? ?? ?? ???? ?? ??Statements     ?? ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?? ?? ?? ???? ?? ?? ??Income      ?? ??Cash & equiv ??[5,010] ?? 3,406 ?? ?? ?? ???? ?? ?? ??Balance ??  ?? ??Short-term   ?? 2,266  ??  343  ?? ?? ?? ???? ?? ?? ??Cash Flow   ?? ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?? ?? ?? ???? ?? ??               ??        ??                             ?? ?? ???? ?? ??Notes          ??   Highlighted cell                    ?? ?? ???? ?? ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?? ?? ???? ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?? ???��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??```

---

## 4. Footnote, Reference & Appendix Popup System (Detailed Specification)

### 4.1 Problem Statement

Financial documents (10-K filings, audit reports) heavily rely on footnotes, references, and appendices to provide critical context. The traditional reading experience forces users to:
- Scroll away from their current reading position
- Lose context while navigating to footnotes at page bottom
- Jump between sections for cross-references (e.g., "See Note 12 to Financial Statements")
- Manually track where they were reading before the interruption

**This creates significant friction for auditors, analysts, and researchers** who need to verify source material while maintaining reading flow.

### 4.2 Solution: Inline Contextual Popups

Implement a smart popup system that displays footnote, reference, and appendix content **inline** without disrupting the user's reading position. Inspired by:
- **Google Scholar PDF Reader** (2024): Inline citation previews
- **Papers ePDF Reader**: Hover-over citation information
- **Semantic Reader Project**: AI-augmented reading interfaces
- **Tufte CSS Sidenotes**: Marginal note paradigm

### 4.3 Reference Types in Financial Documents

| Type | Marker Example | Content Location | Popup Behavior |
|------|----------------|------------------|----------------|
| **Footnote** | ¹, ², ³, *, ??| Bottom of same page | Instant hover popup |
| **Endnote** | [1], [2], (1) | End of document section | Click to preview |
| **Cross-Reference** | "See Note 12" | Different section | Preview + navigate option |
| **Appendix Reference** | "Appendix A" | End of document | Preview first paragraph + expand |
| **Accounting Standard** | "ASC 606" | External reference | Definition popup |

### 4.4 User Interaction Patterns

#### 4.4.1 Footnote Hover Flow
```
?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�???? Document Content                                                    ???? ?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�  ????                                                                     ???? Revenue recognition follows ASC 606¹ guidelines for contracts...    ????                              ??                                     ????                              ??Hover (300ms delay)                  ????                              ??                                     ????                   ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??                 ????                   ??¹ ASC 606 - Revenue from     ??                 ????                   ??Contracts with Customers,    ??                 ????                   ??effective for fiscal years   ??                 ????                   ??beginning after Dec 15, 2017 ??                 ????                   ??                             ??                 ????                   ??[Pin] [Go to Note] [Copy]    ??                 ????                   ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??                 ????                                                                     ???? The Company applies the five-step model...                         ???��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??```

#### 4.4.2 Cross-Reference Preview Flow
```
?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�???? Financial Statements Section                                        ???? ?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�  ????                                                                     ???? Cash and cash equivalents (See Note 4) increased by $1,604M...     ????                             ??                                      ????                             ??Click                                 ????                             ??                                      ???? ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??   ???? ???�� Note 4: Cash and Cash Equivalents                        ??   ???? ???�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?� ??   ???? ??                                                             ??   ???? ??The Company considers all highly liquid investments with    ??   ???? ??original maturities of three months or less at the date of ??   ???? ??purchase to be cash equivalents. Cash equivalents consist  ??   ???? ??primarily of money market funds and time deposits.          ??   ???? ??                                                             ??   ???? ??As of October 29, 2017, cash and cash equivalents totaled  ??   ???? ??$5,010 million, of which $4,212 million was held by        ??   ???? ??foreign subsidiaries.                                       ??   ???? ??                                                             ??   ???? ??[?�� Pin Popup] [?�️ Navigate to Full Note] [?�� Copy]         ??   ???? ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??   ????                                                                     ???? The increase was primarily due to strong operating cash flow...    ???��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??```

#### 4.4.3 Pinned Sidenote Mode
```
?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�???? Document Content                          ?? Pinned Reference      ???? ?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�  ?? ?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�    ????                                           ??                       ???? Revenue recognition follows ASC 606¹     ?? ?�� Note 4: Cash       ???? guidelines. The Company applies the       ??                       ???? five-step model to determine when         ?? Cash equivalents      ???? revenue should be recognized:             ?? consist primarily     ????                                           ?? of money market       ???? 1. Identify the contract                  ?? funds and time        ???? 2. Identify performance obligations       ?? deposits. As of       ???? 3. Determine transaction price            ?? Oct 29, 2017, total   ???? 4. Allocate transaction price             ?? was $5,010M.          ???? 5. Recognize revenue when satisfied       ??                       ????                                           ?? [Unpin] [Expand]      ???? See Note 4 for cash flow details...      ??                       ???��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??```

### 4.5 Popup UI Components

#### 4.5.1 Standard Footnote Popup
```
?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?????��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�????????¹                                                    ?????????�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�  ????????Revenue from contracts with customers is recognized ????????when control of goods or services is transferred    ????????to the customer at an amount that reflects the     ????????consideration the Company expects to be entitled    ????????to receive.                                         ????????                                                    ?????????��??�?�?�?�?�?�???��??�?�?�?�?�?�?�?�?�?�?�?�?�?�???��??�?�?�?�?�??             ???????????�� Pin ????Go to Section ????Copy ??             ?????????��??�?�?�?�?�?�???��??�?�?�?�?�?�?�?�?�?�?�?�?�?�???��??�?�?�?�?�??             ???????��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?????��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??
Width: 320-480px (responsive)
Max Height: 300px (scrollable if longer)
Position: Appear near trigger, smart edge detection
```

#### 4.5.2 Cross-Reference Preview Popup
```
?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?????��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?????????�� Note 12: Stockholders' Equity                    ?????????�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�  ????????                                                    ????????Common Stock                                        ????????The Company is authorized to issue 2,500,000,000   ????????shares of common stock. As of October 29, 2017,    ????????1,074,223,064 shares were issued and outstanding.  ????????                                                    ?????????��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??  ??????????Preview showing 25% of full note content...  ??  ?????????��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??  ????????                                                    ?????????��??�?�?�?�?�?�???��??�?�?�?�?�?�?�?�?�?�?�?�?�?�???��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?? ???????????�� Pin ????Read Full Note????Open in New Tab ?? ?????????��??�?�?�?�?�?�???��??�?�?�?�?�?�?�?�?�?�?�?�?�?�???��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?? ???????��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?????��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??
Width: 400-560px (wider for notes with tables)
Max Height: 400px
Expandable: Click to show full content
```

### 4.6 Technical Implementation

#### 4.6.1 Footnote Detection & Parsing

```typescript
// Types for footnote system
interface FootnoteReference {
  id: string;
  marker: string;           // "1", "2", "*", "??
  type: 'footnote' | 'endnote' | 'cross-reference' | 'appendix';
  sourcePosition: {
    page: number;
    paragraph: number;
    charOffset: number;
  };
  targetPosition: {
    page: number;
    section: string;
    anchor: string;
  };
  content: string;          // Footnote text content
  contentPreview: string;   // First 200 chars for quick preview
}

interface FootnotePopupState {
  isVisible: boolean;
  isPinned: boolean;
  position: { x: number; y: number };
  footnote: FootnoteReference | null;
  expandedView: boolean;
}
```

#### 4.6.2 Component Architecture

```
src/components/FootnoteSystem/
?��??� FootnoteProvider.tsx       # Context for footnote state management
?��??� FootnoteMarker.tsx         # Clickable/hoverable footnote indicator
?��??� FootnotePopup.tsx          # Main popup component
?��??� CrossReferenceLink.tsx     # "See Note X" link component
?��??� PinnedSidenote.tsx         # Pinned reference sidebar
?��??� FootnoteTooltip.tsx        # Quick hover tooltip
?��??� hooks/
    ?��??� useFootnoteDetection.ts    # Parse document for references
    ?��??� usePopupPosition.ts        # Smart positioning logic
    ?��??� useFootnoteNavigation.ts   # Navigate to full reference
```

#### 4.6.3 Smart Positioning Algorithm

```typescript
function calculatePopupPosition(
  triggerRect: DOMRect,
  popupSize: { width: number; height: number },
  viewport: { width: number; height: number }
): { x: number; y: number; placement: 'top' | 'bottom' | 'left' | 'right' } {
  
  const MARGIN = 16;
  const ARROW_OFFSET = 12;
  
  // Prefer bottom placement
  let placement: 'top' | 'bottom' | 'left' | 'right' = 'bottom';
  let x = triggerRect.left + (triggerRect.width / 2) - (popupSize.width / 2);
  let y = triggerRect.bottom + ARROW_OFFSET;
  
  // Check bottom overflow ??try top
  if (y + popupSize.height > viewport.height - MARGIN) {
    placement = 'top';
    y = triggerRect.top - popupSize.height - ARROW_OFFSET;
  }
  
  // Check top overflow ??try right
  if (y < MARGIN) {
    placement = 'right';
    x = triggerRect.right + ARROW_OFFSET;
    y = triggerRect.top;
  }
  
  // Horizontal bounds checking
  x = Math.max(MARGIN, Math.min(x, viewport.width - popupSize.width - MARGIN));
  
  return { x, y, placement };
}
```

### 4.7 Footnote Mapping Data Structure

For the POC, footnote mappings will be pre-defined in JSON:

```json
{
  "document": "AMAT_10K_2017.pdf",
  "footnotes": [
    {
      "id": "fn-1",
      "marker": "1",
      "type": "footnote",
      "page": 45,
      "triggerText": "ASC 606¹",
      "content": "ASC 606 - Revenue from Contracts with Customers, effective for fiscal years beginning after December 15, 2017. The Company adopted this standard using the modified retrospective approach.",
      "targetSection": null
    },
    {
      "id": "note-4-ref",
      "marker": "Note 4",
      "type": "cross-reference",
      "page": 45,
      "triggerText": "See Note 4",
      "contentPreview": "Cash and cash equivalents consist primarily of money market funds and time deposits...",
      "content": "Note 4: Cash and Cash Equivalents\n\nThe Company considers all highly liquid investments with original maturities of three months or less...",
      "targetSection": "notes-to-financial-statements",
      "targetPage": 67
    },
    {
      "id": "appendix-a-ref",
      "marker": "Appendix A",
      "type": "appendix",
      "page": 12,
      "triggerText": "See Appendix A",
      "contentPreview": "Risk Factor Details: The following provides additional detail on material risks...",
      "targetSection": "appendix-a-risk-factors",
      "targetPage": 120
    }
  ],
  "koreanFootnotes": [
    {
      "id": "주석-4",
      "marker": "주석 4",
      "type": "cross-reference",
      "page": 12,
      "triggerText": "주석 4,26,33",
      "contentPreview": "매출???�식 기�?: ?�사??고객과의 계약?�서 ?�기???�익 기�???..",
      "content": "주석 4: 매출??n\n?�사???�국채택�?��?�계기�? ??115?�에 ?�라 매출?�을 ?�식?�니??..",
      "targetSection": "주석",
      "targetPage": 45
    }
  ]
}
```

### 4.8 Accessibility Requirements

| Requirement | Implementation |
|-------------|----------------|
| Keyboard Navigation | Tab to footnote marker, Enter to open popup, Escape to close |
| Screen Reader | ARIA labels: `aria-describedby`, `role="tooltip"` |
| Focus Management | Focus trapped in popup when open, return to trigger on close |
| Color Contrast | WCAG AA compliant (4.5:1 ratio minimum) |
| Reduced Motion | Respect `prefers-reduced-motion` for animations |

### 4.9 Performance Considerations

| Aspect | Target | Implementation |
|--------|--------|----------------|
| Popup Render | < 50ms | Pre-render popup content, lazy load full note |
| Hover Delay | 300ms | Prevent accidental triggers, cancel on mouse leave |
| Content Fetch | < 200ms | Cache footnote content in memory |
| Pin State | Instant | Local state management, no server round-trip |

### 4.10 Korean Document Support (SK Hynix)

Korean financial documents have specific annotation patterns:

| Korean Term | English Equivalent | Handling |
|-------------|-------------------|----------|
| 주석 | Notes | Cross-reference popup |
| 각주 | Footnote | Inline popup |
| 부�?| Appendix | Section preview |
| 참조 | Reference | Link with preview |

---

## 5. Data Specifications

### 5.1 US Market (AMAT)

**Company:** Applied Materials, Inc.  
**Ticker:** AMAT  
**Document:** 10-K Annual Report

**Income Statement Data:**

| Line Item | FY15 | FY16 | FY17 | FY18 | FY19 | FY20 | FY21 | FY22 | FY23 | FY24 |
|-----------|------|------|------|------|------|------|------|------|------|------|
| Sales | 9,659 | 10,825 | 14,537 | 17,253 | 14,608 | 17,202 | 23,063 | 25,785 | 26,517 | 27,176 |
| Cost of Goods | 6,706 | 6,202 | 8,020 | 9,346 | 8,265 | 9,657 | 12,835 | 14,450 | 14,731 | 14,849 |
| Gross Income | 2,953 | 4,623 | 6,517 | 7,907 | 6,343 | 7,545 | 10,228 | 11,335 | 11,786 | 12,327 |
| Net Income | 1,377 | 1,721 | 3,434 | 3,313 | 2,706 | 3,619 | 5,888 | 6,525 | 6,856 | 7,177 |

**Document Viewer Highlight:**
- Balance Sheet: Cash and cash equivalents **$5,010M** (Oct 2017)

### 5.2 KR Market (SK Hynix)

**Company:** SK Hynix Inc.  
**Document:** ?�결감사보고??(Consolidated Audit Report)

**?�결?�괄?�익계산??(Consolidated Statement of Comprehensive Income):**

| 과목 | 주석 | ??5�?(2022) | ??4�?(2021) |
|------|------|---------------|---------------|
| ?? 매출??| 4,26,33 | 44,621,568 | **42,997,792** |
| ?? 매출?��? | 28,33 | 28,993,713 | 24,045,600 |
| ?? 매출총이??| | 15,627,855 | 18,952,192 |

**Document Viewer Highlight:**
- 매출??**42,997,792** (백만?? ??4�?

---

## 6. Technical Architecture

### 6.1 Tech Stack

| Layer | Technology | Rationale |
|-------|------------|-----------|
| Frontend | Next.js 14+ (App Router) | Rapid prototyping, SSR support |
| UI Framework | Tailwind CSS | Fast styling, responsive design |
| PDF Rendering | iframe / react-pdf | Simple integration, smooth scroll |
| State Management | React useState/Context | Lightweight, POC-appropriate |
| Language | TypeScript | Type safety, better DX |

### 6.2 Component Structure

```
src/
?��??� app/
??  ?��??� layout.tsx
??  ?��??� page.tsx              # Landing page
??  ?��??� globals.css
?��??� components/
??  ?��??� LandingPage/
??  ??  ?��??� FinancialTable.tsx
??  ??  ?��??� MarketTabs.tsx
??  ??  ?��??� ClickableCell.tsx
??  ?��??� DocumentViewer/
??  ??  ?��??� ViewerModal.tsx
??  ??  ?��??� Navigation.tsx
??  ??  ?��??� DocumentContent.tsx
??  ??  ?��??� HighlightOverlay.tsx
??  ?��??� FootnoteSystem/           # NEW: Footnote/Reference Popup System
??  ??  ?��??� FootnoteProvider.tsx      # Context for state management
??  ??  ?��??� FootnoteMarker.tsx        # Clickable/hoverable indicator (¹, ², *)
??  ??  ?��??� FootnotePopup.tsx         # Main popup component
??  ??  ?��??� CrossReferenceLink.tsx    # "See Note X" link with preview
??  ??  ?��??� AppendixPreview.tsx       # Appendix section quick view
??  ??  ?��??� PinnedSidenote.tsx        # Pinned reference sidebar panel
??  ??  ?��??� FootnoteTooltip.tsx       # Quick hover tooltip
??  ?��??� common/
??      ?��??� Modal.tsx
??      ?��??� Popup.tsx                 # Reusable popup base component
??      ?��??� Button.tsx
?��??� data/
??  ?��??� amat-financials.json
??  ?��??� skhynix-financials.json
??  ?��??� document-mapping.json
??  ?��??� footnote-mapping.json         # NEW: Footnote/reference definitions
?��??� hooks/
??  ?��??� useDocumentViewer.ts
??  ?��??� useFootnoteDetection.ts       # NEW: Parse doc for references
??  ?��??� usePopupPosition.ts           # NEW: Smart edge-aware positioning
??  ?��??� useFootnoteNavigation.ts      # NEW: Navigate to full reference
?��??� types/
    ?��??� index.ts
    ?��??� footnotes.ts                  # NEW: Footnote type definitions
```

### 6.3 Data Flow

```
?��??�?�?�?�?�?�?�?�?�?�?�?�??   Click Cell    ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�????Landing     ???�?�?�?�?�?�?�?�?�?�?�?�?�?�?�????Document Viewer  ????Page        ??                 ??Modal            ???��??�?�?�?�?�?�?�?�?�?�?�?�??                 ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??      ??                                  ??      ??                                  ??      ??                                  ???��??�?�?�?�?�?�?�?�?�?�?�?�??                 ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�????Financial   ??                 ??PDF Iframe/      ????Data JSON   ??                 ??React-PDF        ???��??�?�?�?�?�?�?�?�?�?�?�?�??                 ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??      ??                                  ??      ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??                      ??                      ??              ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??              ??Document Mapping ??              ??(cell ??section) ??              ?��??�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�?�??```

---

## 7. UI/UX Specifications

### 7.1 Landing Page Table

**Hover State:**
```css
.clickable-cell:hover {
  background-color: #E8F4FD;
  cursor: pointer;
}
.clickable-cell:hover::after {
  content: "Click to view source";
  /* tooltip styles */
}
```

### 7.2 Document Viewer Modal

**Dimensions:**
- Width: 90vw (max 1400px)
- Height: 85vh
- Navigation sidebar: 250px fixed

**Highlight Style:**
```css
.highlighted-row {
  background-color: #FFEB3B;
  font-weight: bold;
  border: 2px solid #FFC107;
  animation: pulse 2s ease-in-out;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}
```

### 7.3 Responsive Behavior

| Breakpoint | Behavior |
|------------|----------|
| Desktop (>1024px) | Full layout with sidebar |
| Tablet (768-1024px) | Collapsible sidebar |
| Mobile (<768px) | Full-screen modal, hidden sidebar |

---

## 8. Interaction Specifications

### 8.1 Cell Click Flow

1. **Hover** (0ms)
   - Background color change
   - Cursor: pointer
   - Tooltip appears after 500ms delay

2. **Click** (0ms)
   - Loading spinner appears
   - Fetch document mapping

3. **Modal Open** (<300ms)
   - Fade-in animation
   - Background dimmed (rgba(0,0,0,0.5))

4. **Document Load** (<1000ms)
   - PDF renders in viewer
   - Auto-scroll to target section
   - Highlight animation plays

### 8.2 Close Behaviors

| Trigger | Action |
|---------|--------|
| X Button | Close modal |
| ESC Key | Close modal |
| Outside Click | Close modal (optional) |
| Back Button | Close modal |

---

## 9. Assets Required

### 9.1 PDF Documents

| Document | Market | Status | Location |
|----------|--------|--------|----------|
| AMAT 10-K | US | ??Available | `assets/pdfs/AMAT_10K.pdf` |
| SK Hynix 감사보고??| KR | ??Available | `assets/pdfs/SK_Hynix_10K.pdf` |

### 9.2 Screen Recordings (Reference)

| Recording | Purpose | Status | Location |
|-----------|---------|--------|----------|
| factset audit_amat_us.mp4 | US market flow demo | ??Available | `assets/recordings/` |
| factset audit_sk hynix_korea.mp4 | KR market flow demo | ??Available | `assets/recordings/` |

---

## 10. Success Criteria

### 10.1 Functional Requirements

**Core Document Viewer:**
- [ ] User can view financial data table on landing page
- [ ] User can switch between US and KR market views
- [ ] User can click any numeric cell to open Document Viewer
- [ ] Document Viewer displays correct source PDF
- [ ] Document auto-scrolls to relevant section
- [ ] Relevant data is highlighted in document
- [ ] User can navigate document via sidebar TOC
- [ ] User can close modal via X, ESC, or outside click

**Footnote/Reference Popup System (Core Differentiator):**
- [ ] Hovering over footnote marker (¹, ², *) shows inline popup
- [ ] Popup appears within 300ms of hover, near the trigger element
- [ ] Popup displays full footnote content without scrolling away
- [ ] Clicking "See Note X" shows preview of that note section
- [ ] User can pin popup to keep it visible while reading
- [ ] Pinned references appear in side panel (Tufte-style sidenotes)
- [ ] User can navigate to full note from popup
- [ ] Popup closes on ESC, outside click, or explicit close button
- [ ] Multiple footnotes can be viewed sequentially without losing place
- [ ] Korean documents (주석, 각주) work identically to English

### 10.2 Performance Targets

| Metric | Target |
|--------|--------|
| Initial Page Load | < 2s |
| Modal Open Animation | < 300ms |
| PDF Load Time | < 1.5s |
| Scroll to Section | < 500ms |
| Footnote Popup Render | < 50ms |
| Hover-to-Popup Delay | 300ms (intentional) |
| Cross-Reference Preview Load | < 200ms |
| Pin/Unpin Action | Instant (< 16ms) |

---

## 11. Future Roadmap (Post-POC)

### Phase 2: Enhanced Document Intelligence
- Precise number-to-location mapping
- Cross-document data tracking
- Footnote popup functionality
- Bookmark persistence

### Phase 3: AI Integration
- Document summarization
- Q&A capabilities
- Automated data extraction
- Anomaly detection

### Phase 4: Full Product
- Multi-user workspaces
- Document upload pipeline
- Real-time collaboration
- Export and reporting

---

## 12. Appendix

### A. Related Linear Issues

| Issue | Title | Status |
|-------|-------|--------|
| [QT-46](https://linear.app/betalgeuse/issue/QT-46) | Factset 목업 ?�면 ?�화?� PDF ?�료 ?�청 | In Progress |
| [QT-65](https://linear.app/betalgeuse/issue/QT-65) | Create new PRD for Factset audit POC | In Progress |

### B. Reference Materials

- AMAT 10-K (FY2017): Consolidated Balance Sheets
- SK Hynix ?�결감사보고?? ?�결?�괄?�익계산??- Factset Document Viewer UI mockups (Linear attachments)
- Screen recording demos (Linear attachments)

### C. Industry Best Practices Applied

1. **Source Provenance Tracking**: Every displayed number links to its original document location
2. **Audit Trail Support**: Clear visual connection between data and source
3. **Cross-Document Navigation**: TOC sidebar for efficient document exploration
4. **Responsive Design**: Works across desktop and mobile devices
5. **Performance Optimization**: Lazy loading for PDF content

### D. Footnote/Reference Popup Research Sources

The inline footnote popup system is based on extensive research from:

**Academic Paper Readers:**
- **Google Scholar PDF Reader (2024)**: Inline citation previews, clickable references that show previews without losing reading position
- **Papers ePDF Reader**: Hover-over citation information, informational panels for figures and references
- **Semantic Reader Project**: AI-augmented reading interfaces with dynamic popups
- **PubReader (NIH/NCBI)**: Multi-column layout with image strips and inline citation previews

**UX Research & Guidelines:**
- **Nielsen Norman Group**: Tooltips should provide supplementary information without blocking critical content
- **UXPlanet Tooltip Guidelines**: Clarity, consistency, timing, accessibility compliance
- **Tufte CSS Sidenotes**: Marginal notes paradigm for maintaining reading flow

**Implementation References:**
- **react-a11y-footnotes**: Accessible React component for footnote references
- **curvenote/sidenotes**: Floating sidenotes with inline references
- **Littlefoot.js**: Interactive footnote popups with elegant animations
- **rehype-sidenotes**: Transform footnotes to inline sidenotes

**Financial Document Standards:**
- **SEC Regulation S-K**: Cross-referencing requirements for 10-K filings
- **XBRL/Inline XBRL**: Tagged financial data for machine readability
- **FISD Audit Best Practices**: Market data audit workflow standards

### E. Competitive Analysis

| Feature | Factset Current | Bloomberg | Our POC |
|---------|-----------------|-----------|---------|
| Footnote Hover | ❌ | ❌ | ✅ |
| Cross-Reference Preview | ❌ | ❌ | ✅ |
| Pinned Sidenotes | ❌ | ❌ | ✅ |
| Source Provenance | Partial | Partial | ✅ Full |
| Multi-language (KR/EN) | ✅ | ✅ | ✅ |

---

*Document maintained by: Development Team*  
*Last updated: 2025-12-08*
